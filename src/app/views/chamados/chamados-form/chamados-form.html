<div class="form-container" [attr.data-mode]="isEditando() ? 'edit' : 'new'">
  <!-- CABE√áALHO -->
  <div class="form-header">
    <h1 class="form-title">
      {{ isEditando() ? '‚úèÔ∏è Editar Chamado' : '‚ûï Novo Chamado' }}
    </h1>
    <p class="form-subtitle">
      {{ isEditando() ? 'Atualize as informa√ß√µes do chamado' : 'Crie um novo chamado no sistema' }}
    </p>
  </div>

  <!-- ALERTA -->
  @if (showAlert()) {
    <div class="alert alert-{{alertType()}} alert-dismissible">
      <div class="alert-content">
        <span class="alert-icon">
          @if (alertType() === 'success') { ‚úÖ }
          @if (alertType() === 'error') { ‚ùå }
        </span>
        <span class="alert-message">{{ alertMessage() }}</span>
      </div>
      <button type="button" class="alert-close" (click)="fecharAlert()">√ó</button>
    </div>
  }

  <form (ngSubmit)="salvarChamado()" #chamadoForm="ngForm" class="chamado-form">
    
    <!-- SE√á√ÉO: INFORMA√á√ïES B√ÅSICAS -->
    <div class="form-section">
      <h3 class="section-title">üìã Informa√ß√µes do Chamado</h3>
      
      <!-- T√çTULO -->
      <div class="form-group">
        <label for="titulo" class="form-label required">T√≠tulo do Chamado</label>
        <input 
          type="text" 
          id="titulo" 
          [ngModel]="chamado().titulo"
          (ngModelChange)="atualizarTitulo($event)"
          name="titulo" 
          required
          minlength="5"
          maxlength="100"
          class="form-control"
          placeholder="Ex: Problema com internet no setor administrativo">
        
        @if (chamadoForm.controls['titulo']?.invalid && chamadoForm.controls['titulo']?.touched) {
          <div class="error-message">
            @if (chamadoForm.controls['titulo']?.errors?.['required']) {
              <span>T√≠tulo √© obrigat√≥rio</span>
            }
            @if (chamadoForm.controls['titulo']?.errors?.['minlength']) {
              <span>T√≠tulo deve ter pelo menos 5 caracteres</span>
            }
          </div>
        }
      </div>

      <!-- DESCRI√á√ÉO -->
      <div class="form-group">
        <label for="descricao" class="form-label required">Descri√ß√£o Detalhada</label>
        <textarea 
          id="descricao" 
          [ngModel]="chamado().descricao"
          (ngModelChange)="atualizarDescricao($event)"
          name="descricao" 
          required
          minlength="10"
          rows="5"
          class="form-control"
          placeholder="Descreva detalhadamente o problema ou solicita√ß√£o..."></textarea>
        
        @if (chamadoForm.controls['descricao']?.invalid && chamadoForm.controls['descricao']?.touched) {
          <div class="error-message">
            @if (chamadoForm.controls['descricao']?.errors?.['required']) {
              <span>Descri√ß√£o √© obrigat√≥ria</span>
            }
            @if (chamadoForm.controls['descricao']?.errors?.['minlength']) {
              <span>Descri√ß√£o deve ter pelo menos 10 caracteres</span>
            }
          </div>
        }
      </div>

      <!-- PRIORIDADE -->
      <div class="form-group">
        <label for="prioridade" class="form-label required">Prioridade</label>
        <select 
          id="prioridade"
          [ngModel]="chamado().prioridade"
          (ngModelChange)="atualizarPrioridade($event)"
          name="prioridade"
          required
          class="form-control">
          <option value="BAIXA">üü¢ Baixa</option>
          <option value="MEDIA">üü° M√©dia</option>
          <option value="ALTA">üî¥ Alta</option>
        </select>
      </div>
    </div>

    <!-- SE√á√ÉO: ATENDIMENTO -->
    <div class="form-section">
      <h3 class="section-title">üë• Atendimento</h3>
      
      <div class="form-row">
        <!-- CLIENTE -->
        <div class="form-group">
          <label for="clienteId" class="form-label required">Cliente</label>
          <select 
            id="clienteId"
            [ngModel]="chamado().clienteId"
            (ngModelChange)="atualizarClienteId($event)"
            name="clienteId"
            required
            class="form-control">
            @for (cliente of clientes(); track cliente.id) {
              <option [value]="cliente.id">
                {{ cliente.nome }} - {{ cliente.email }}
              </option>
            }
          </select>
          
          @if (chamadoForm.controls['clienteId']?.invalid && chamadoForm.controls['clienteId']?.touched) {
            <div class="error-message">
              <span>Selecione um cliente</span>
            </div>
          }
        </div>

        <!-- T√âCNICO -->
        <div class="form-group">
          <label for="tecnicoId" class="form-label">T√©cnico Respons√°vel</label>
          <select 
            id="tecnicoId"
            [ngModel]="chamado().tecnicoId"
            (ngModelChange)="atualizarTecnicoId($event)"
            name="tecnicoId"
            class="form-control">
            <option value="">N√£o atribu√≠do</option>
            
            <!-- T√©cnicos dispon√≠veis -->
            @if (tecnicosDisponiveis().length > 0) {
              <optgroup label="üü¢ Dispon√≠veis">
                @for (tecnico of tecnicosDisponiveis(); track tecnico.id) {
                  <option [value]="tecnico.id">
                    {{ tecnico.nome }} - {{ tecnico.especialidade }}
                  </option>
                }
              </optgroup>
            }
            
            <!-- T√©cnicos ocupados -->
            <optgroup label="üî¥ Ocupados">
              <option *ngFor="let tecnico of todosTecnicos()" [value]="tecnico.id" disabled [hidden]="tecnico.disponivel">
                {{ tecnico.nome }} - {{ tecnico.especialidade }} (Ocupado)
              </option>
            </optgroup>
          </select>
          
        </div>
      </div>
    </div>

    <!-- SE√á√ÉO: STATUS (APENAS EDI√á√ÉO) -->
    @if (isEditando()) {
      <div class="form-section">
        <h3 class="section-title">üîÑ Status do Chamado</h3>
        
        <div class="form-group">
          <label for="status" class="form-label">Status Atual</label>
          <div class="status-options">
            <label class="radio-option">
              <input 
                type="radio" 
                name="status" 
                [value]="'ABERTO'"
                [checked]="chamado().status === 'ABERTO'"
                (change)="atualizarStatus('ABERTO')">
              <span class="radio-label status-aberto">üî¥ Aberto</span>
            </label>
            
            <label class="radio-option">
              <input 
                type="radio" 
                name="status" 
                [value]="'EM_ANDAMENTO'"
                [checked]="chamado().status === 'EM_ANDAMENTO'"
                (change)="atualizarStatus('EM_ANDAMENTO')">
              <span class="radio-label status-andamento">üü° Em Andamento</span>
            </label>
            
            <label class="radio-option">
              <input 
                type="radio" 
                name="status" 
                [value]="'FECHADO'"
                [checked]="chamado().status === 'FECHADO'"
                (change)="atualizarStatus('FECHADO')">
              <span class="radio-label status-fechado">üü¢ Fechado</span>
            </label>
          </div>
        </div>

        <!-- A√ß√µes r√°pidas de status -->
        <div class="quick-actions">
          @if (chamado().status !== 'FECHADO') {
            <button type="button" class="btn btn-sm btn-success" (click)="fecharChamado()">
              ‚úÖ Fechar Chamado
            </button>
          }
          
          @if (chamado().status === 'FECHADO') {
            <button type="button" class="btn btn-sm btn-warning" (click)="reabrirChamado()">
              üîÑ Reabrir Chamado
            </button>
          }
        </div>
      </div>
    }

    <!-- INFORMA√á√ïES DO SISTEMA (APENAS EDI√á√ÉO) -->
    @if (isEditando()) {
      <div class="readonly-info">
        <h4 class="section-title">üìä Informa√ß√µes do Sistema</h4>
        <div class="info-grid">
          <div class="info-item">
            <span class="info-label">ID do Chamado</span>
            <span class="info-value">#{{ chamado().id }}</span>
          </div>
          <div class="info-item">
            <span class="info-label">Data de Abertura</span>
            <span class="info-value">{{ chamado().dataAbertura | date:'dd/MM/yyyy HH:mm' }}</span>
          </div>
          @if (chamado().dataFechamento) {
            <div class="info-item">
              <span class="info-label">Data de Fechamento</span>
              <span class="info-value">{{ chamado().dataFechamento | date:'dd/MM/yyyy HH:mm' }}</span>
            </div>
          }
          @if (clienteSelecionado()) {
            <div class="info-item">
              <span class="info-label">Cliente Selecionado</span>
              <span class="info-value">{{ clienteSelecionado()!.nome }}</span>
            </div>
          }
          @if (tecnicoSelecionado()) {
            <div class="info-item">
              <span class="info-label">T√©cnico Atribu√≠do</span>
              <span class="info-value">{{ tecnicoSelecionado()!.nome }}</span>
            </div>
          }
        </div>
      </div>
    }

    <!-- A√á√ïES DO FORMUL√ÅRIO -->
    <div class="form-actions">
      <button 
        type="submit" 
        class="btn btn-primary"
        [disabled]="!isFormularioValido()">
        üíæ {{ isEditando() ? 'Atualizar Chamado' : 'Criar Chamado' }}
      </button>
      
      <button 
        type="button" 
        class="btn btn-secondary" 
        (click)="cancelar()">
        ‚ùå Cancelar
      </button>

      <!-- A√ß√£o adicional: Limpar formul√°rio -->
      @if (!isEditando()) {
        <button 
          type="button" 
          class="btn btn-outline" 
          (click)="chamadoForm.reset()">
          üßπ Limpar
        </button>
      }
    </div>

  </form>
</div>